<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Probation review report</title>
  <meta name="description" content="Probation review report">
  <meta name="generator" content="bookdown 0.4 and GitBook 2.6.7">

  <meta property="og:title" content="Probation review report" />
  <meta property="og:type" content="book" />
  
  
  
  <meta name="github-repo" content="ellessenne/prr" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Probation review report" />
  
  
  

<meta name="author" content="Alessandro Gasparini">


<meta name="date" content="2017-08-03">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="sa-estsurv.html">
<link rel="next" href="sa-cox.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Introduction</a></li>
<li class="chapter" data-level="1" data-path="sa.html"><a href="sa.html"><i class="fa fa-check"></i><b>1</b> Introduction to survival analysis</a><ul>
<li class="chapter" data-level="1.1" data-path="sa-survdata.html"><a href="sa-survdata.html"><i class="fa fa-check"></i><b>1.1</b> Survival data</a></li>
<li class="chapter" data-level="1.2" data-path="sa-censoring.html"><a href="sa-censoring.html"><i class="fa fa-check"></i><b>1.2</b> Censoring</a></li>
<li class="chapter" data-level="1.3" data-path="sa-terminology-notation.html"><a href="sa-terminology-notation.html"><i class="fa fa-check"></i><b>1.3</b> Terminology and notation</a></li>
<li class="chapter" data-level="1.4" data-path="sa-estsurv.html"><a href="sa-estsurv.html"><i class="fa fa-check"></i><b>1.4</b> Estimation of the survival function</a></li>
<li class="chapter" data-level="1.5" data-path="sa-parsa.html"><a href="sa-parsa.html"><i class="fa fa-check"></i><b>1.5</b> Parametric survival analysis</a><ul>
<li class="chapter" data-level="1.5.1" data-path="sa-parsa.html"><a href="sa-parsa.html#sa-parsa-distributions"><i class="fa fa-check"></i><b>1.5.1</b> Failure time distribution</a></li>
<li class="chapter" data-level="1.5.2" data-path="sa-parsa.html"><a href="sa-parsa.html#sa-parsa-estimation"><i class="fa fa-check"></i><b>1.5.2</b> Estimation procedure</a></li>
<li class="chapter" data-level="1.5.3" data-path="sa-parsa.html"><a href="sa-parsa.html#sa-parsa-example"><i class="fa fa-check"></i><b>1.5.3</b> Data analysis example</a></li>
</ul></li>
<li class="chapter" data-level="1.6" data-path="sa-cox.html"><a href="sa-cox.html"><i class="fa fa-check"></i><b>1.6</b> The Cox model</a></li>
<li class="chapter" data-level="1.7" data-path="sa-advanced.html"><a href="sa-advanced.html"><i class="fa fa-check"></i><b>1.7</b> Advanced survival analysis</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="smre.html"><a href="smre.html"><i class="fa fa-check"></i><b>2</b> Survival models with random effects</a></li>
<li class="chapter" data-level="3" data-path="jm.html"><a href="jm.html"><i class="fa fa-check"></i><b>3</b> Joint models for longitudinal and survival data</a></li>
<li class="chapter" data-level="4" data-path="compch.html"><a href="compch.html"><i class="fa fa-check"></i><b>4</b> Computational challenges in survival models with random effects</a></li>
<li class="chapter" data-level="5" data-path="simst1.html"><a href="simst1.html"><i class="fa fa-check"></i><b>5</b> Simulation study: accuracy of Gaussian quadrature</a><ul>
<li class="chapter" data-level="5.1" data-path="simst1-aim.html"><a href="simst1-aim.html"><i class="fa fa-check"></i><b>5.1</b> Aim</a></li>
<li class="chapter" data-level="5.2" data-path="simst1-dgms.html"><a href="simst1-dgms.html"><i class="fa fa-check"></i><b>5.2</b> Data-generating mechanisms</a></li>
<li class="chapter" data-level="5.3" data-path="simst1-methods.html"><a href="simst1-methods.html"><i class="fa fa-check"></i><b>5.3</b> Methods</a></li>
<li class="chapter" data-level="5.4" data-path="simst1-est.html"><a href="simst1-est.html"><i class="fa fa-check"></i><b>5.4</b> Estimands</a></li>
<li class="chapter" data-level="5.5" data-path="simst1-pm.html"><a href="simst1-pm.html"><i class="fa fa-check"></i><b>5.5</b> Performance measures</a></li>
<li class="chapter" data-level="5.6" data-path="simst1-res.html"><a href="simst1-res.html"><i class="fa fa-check"></i><b>5.6</b> Results</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="simst2.html"><a href="simst2.html"><i class="fa fa-check"></i><b>6</b> Simulation study: impact of misspecification in survival models with shared frailty terms</a><ul>
<li class="chapter" data-level="6.1" data-path="simst2-aim.html"><a href="simst2-aim.html"><i class="fa fa-check"></i><b>6.1</b> Aim</a></li>
<li class="chapter" data-level="6.2" data-path="simst2-dgms.html"><a href="simst2-dgms.html"><i class="fa fa-check"></i><b>6.2</b> Data-generating mechanisms</a></li>
<li class="chapter" data-level="6.3" data-path="simst2-methods.html"><a href="simst2-methods.html"><i class="fa fa-check"></i><b>6.3</b> Methods</a></li>
<li class="chapter" data-level="6.4" data-path="simst2-est.html"><a href="simst2-est.html"><i class="fa fa-check"></i><b>6.4</b> Estimands</a></li>
<li class="chapter" data-level="6.5" data-path="simst2-pm.html"><a href="simst2-pm.html"><i class="fa fa-check"></i><b>6.5</b> Performance measures</a></li>
<li class="chapter" data-level="6.6" data-path="simst2-res.html"><a href="simst2-res.html"><i class="fa fa-check"></i><b>6.6</b> Results</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="sirex.html"><a href="sirex.html"><i class="fa fa-check"></i><b>7</b> Exploring results from simulation studies interactively</a></li>
<li class="chapter" data-level="8" data-path="infvp.html"><a href="infvp.html"><i class="fa fa-check"></i><b>8</b> Informative visiting process</a></li>
<li class="chapter" data-level="9" data-path="future.html"><a href="future.html"><i class="fa fa-check"></i><b>9</b> Future research developments</a></li>
<li class="chapter" data-level="10" data-path="pdevelop.html"><a href="pdevelop.html"><i class="fa fa-check"></i><b>10</b> Personal development</a><ul>
<li class="chapter" data-level="10.1" data-path="supervisory-meetings.html"><a href="supervisory-meetings.html"><i class="fa fa-check"></i><b>10.1</b> Supervisory meetings</a></li>
<li class="chapter" data-level="10.2" data-path="training-and-courses.html"><a href="training-and-courses.html"><i class="fa fa-check"></i><b>10.2</b> Training and courses</a></li>
<li class="chapter" data-level="10.3" data-path="conferences.html"><a href="conferences.html"><i class="fa fa-check"></i><b>10.3</b> Conferences</a></li>
</ul></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="ax-slides.html"><a href="ax-slides.html"><i class="fa fa-check"></i><b>A</b> Slides</a></li>
<li class="chapter" data-level="B" data-path="ax-manuscript.html"><a href="ax-manuscript.html"><i class="fa fa-check"></i><b>B</b> Manuscript</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Probation review report</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="sa-parsa" class="section level2">
<h2><span class="header-section-number">1.5</span> Parametric survival analysis</h2>
<p>In applied settings it is often of interest to assess the association between observed covariates and the survival time of interest. For instance, it may be of interest to study whether a treatment is effective in slowing disease relapse (e.g. relapse of leukemia), whether there are difference between genders or age categories. A common way of assessing the effect of covariates on a time to event outcome, while adjusting for potentially confounding factors at the same time, consists in using a regression model.</p>
<p>In the context of survival data, two models are commonly used: the <em>accelerated failure time</em> model (AFT), and the <em>proportional hazards</em> (PH) model. In the former, the natural logarithm of the observed survival time <span class="math inline">\(\log t\)</span> is expressed as a linear function of the covariates <span class="math inline">\(X\)</span>: <span class="math display">\[
\log t = X \beta + \epsilon
\]</span>, with <span class="math inline">\(\beta\)</span> a vector of regression coefficients and <span class="math inline">\(\epsilon\)</span> a vector of residual error terms. Assuming a parametric distribution for <span class="math inline">\(\epsilon\)</span> determines the regression model: log-normal, log-logistic, Weibull, etc. In the AFT model, a positive association of the covariates with survival time implies an increased expected time to event. In the PH model, the covariates have a multiplicative effect on the hazard function: <span class="math display">\[
h(t) = h_0(t) g(X),
\]</span> for some <span class="math inline">\(h_0(t)\)</span> and <span class="math inline">\(g(X)\)</span>, with <span class="math inline">\(g(\cdot)\)</span>) a non-negative function of the covariates. A popular choice for the latter is <span class="math inline">\(g(X) = \exp(X \beta)\)</span>; conversely, is is possible to either left the former unspecified, or assume a parametric distribution. The focus of this Section is on specifying a parametric distribution for <span class="math inline">\(h_0(t)\)</span>, yielding the so-called <em>parametric survival regression models</em>; I will present commonly assumed parametric distributions in Section <a href="sa-parsa.html#sa-parsa-distributions">1.5.1</a>, the estimation procedure in Section <a href="sa-parsa.html#sa-parsa-estimation">1.5.2</a>, and an example using data from the International Stroke Trial (IST) <span class="citation">(International Stroke Trial Collaborative Group <a href="#ref-ist_1997">1997</a>, <span class="citation">Sandercock, Niewada, and Czlonkowska (<a href="#ref-istdb_2011">2011</a>)</span>)</span> in Section <a href="sa-parsa.html#sa-parsa-example">1.5.3</a>. Leaving <span class="math inline">\(h_0(t)\)</span> unspecified yields the semi-parametric Cox model, that I will present in Section <a href="sa-cox.html#sa-cox">1.6</a>.</p>
<p>From now on I will focus on the proportional hazards formulation of the survival model.</p>
<div id="sa-parsa-distributions" class="section level3">
<h3><span class="header-section-number">1.5.1</span> Failure time distribution</h3>
<p>I mentioned in Section <a href="sa.html#sa">1</a> that the random variable representing the survival time is non-negative; hence, we can choose any non-negative distribution to assign to <span class="math inline">\(h_0(t)\)</span>. Commonly used distribution are the Exponential, Weibull, log-Normal, and Gompertz distributions; other possible distributions are the inverse Weibull, the log-skew-Normal <span class="citation">(Azzalini <a href="#ref-azzalini_1985">1985</a>)</span>, the log-logistic and complex mixture distributions (such as the two components mixture Weibull distribution, <span class="citation">McLachlan and McGiffin (<a href="#ref-mclachlan_1994">1994</a>)</span>). Each distribution yields a different Survival and hazard function:</p>
<ul>
<li>Exponential distribution:
<ul>
<li><span class="math inline">\(h_0(t) = \lambda\)</span></li>
<li><span class="math inline">\(S(t) = \exp(-\lambda t)\)</span></li>
<li><span class="math inline">\(\lambda &gt; 0\)</span></li>
</ul></li>
<li>Weibull distribution:
<ul>
<li><span class="math inline">\(h_0(t) = \lambda p t ^ {p - 1}\)</span></li>
<li><span class="math inline">\(S(t) = \exp(-\lambda t ^ p)\)</span></li>
<li><span class="math inline">\(\lambda, p &gt; 0\)</span></li>
</ul></li>
<li>log-Normal distribution:
<ul>
<li><span class="math inline">\(h_0(t) = \frac{\phi(\frac{\log t - \mu}{\sigma})}{\sigma t \left(1 - \Phi \left[ \frac{\log t - mu}{\sigma} \right] \right)}\)</span></li>
<li><span class="math inline">\(S(t) = 1 - \Phi\left( \frac{\log t - \mu}{\sigma} \right)\)</span></li>
<li><span class="math inline">\(\mu \in R; \sigma &gt; 0\)</span></li>
</ul></li>
<li>Gompertz distribution:
<ul>
<li><span class="math inline">\(h_0(t) = \lambda \exp(\gamma t)\)</span></li>
<li><span class="math inline">\(S(t) = \exp \left[ -\frac{\lambda}{\gamma} (\exp(\gamma t) - 1) \right]\)</span></li>
<li><span class="math inline">\(\lambda, \gamma &gt; 0\)</span></li>
</ul></li>
<li>inverse Weibull distribution:
<ul>
<li><span class="math inline">\(h_0(t) = \frac{\lambda p t ^ {-(p + 1)}}{\exp(\lambda t ^ {-p}) - 1}\)</span></li>
<li><span class="math inline">\(S(t) = 1 - \exp(-\lambda t ^ {-p})\)</span></li>
<li><span class="math inline">\(\lambda, p &gt; 0\)</span></li>
</ul></li>
<li>log-logistic distribution:
<ul>
<li><span class="math inline">\(h_0(t) = \frac{\exp(\alpha) \kappa t ^ {\kappa - 1}}{1 + \exp(\alpha) t ^ \kappa}\)</span></li>
<li><span class="math inline">\(S(t) = \frac{1}{1 + \exp(\alpha) t ^ \kappa}\)</span></li>
<li><span class="math inline">\(\alpha \in R; \kappa &gt; 0\)</span></li>
</ul></li>
<li>log-skew-Normal distribution<a href="#fn2" class="footnoteRef" id="fnref2"><sup>2</sup></a>:
<ul>
<li><span class="math inline">\(h_0(t) = \frac{1 \phi \left( \frac{\log t - \xi}{\omega} \right) \Phi \left( \alpha \frac{\log t - \xi}{\omega}\right)}{t \omega \left[ 1 - SN \left( \log t; \xi, \omega, \alpha \right) \right]}\)</span></li>
<li><span class="math inline">\(S(t) = 1 - SN\left( \log t; \xi, \omega, \alpha \right)\)</span></li>
<li><span class="math inline">\(\xi, \alpha \in R; \omega &gt; 0 \)</span></li>
</ul></li>
<li>Two components mixture Weibull distribution:
<ul>
<li><span class="math inline">\(h_0(t) = \frac{\lambda_1 p_1 t ^ {p_1 - 1} \pi \exp(-\lambda_1 t ^ {p_1}) + \lambda_2 p_2 t ^ {p_2 - 1} (1 - \pi) \exp(-\lambda_2 t ^ {p_2})}{\pi \exp(-\lambda_1 t ^ {p_1}) + (1 - \pi) \exp(-\lambda_2 t ^ {p_2})}\)</span></li>
<li><span class="math inline">\(S(t) = \pi \exp(-\lambda_1 t ^ {p_1}) + (1 - \pi) \exp(-\lambda_2 t ^ {p_2})\)</span></li>
<li><span class="math inline">\(\lambda_1, \lambda_2, p_1, p_2 &gt; 0; \pi \in [0, 1]\)</span></li>
</ul></li>
</ul>
</div>
<div id="sa-parsa-estimation" class="section level3">
<h3><span class="header-section-number">1.5.2</span> Estimation procedure</h3>
<p>Assume <span class="math inline">\(n\)</span> observations with the bivariate response <span class="math inline">\((t_i, d_i)\)</span>, with <span class="math inline">\(i = 1, \dots, n\)</span>. For a given survival function <span class="math inline">\(S(t)\)</span> the density function is given by <span class="math display">\[
f(t) = - \frac{d S(t)}{dt},
\]</span> and the hazard function by <span class="math display">\[
h(t) = \frac{f(t)}{S(t)}.
\]</span></p>
<p>The parameters of the parametric proportional hazards survival model presented in Section <a href="sa-parsa.html#sa-parsa">1.5</a> can be estimated via the maximum likelihood method. A subject that experiences the event of interest at time <span class="math inline">\(t_i\)</span> contributes to the likelihood the density at time <span class="math inline">\(t_i\)</span>, i.e. <span class="math inline">\(f(t_i)\)</span>; conversely, a censored observation know to survive until tile <span class="math inline">\(t_i\)</span> contributes <span class="math inline">\(S(t_i)\)</span> to the likelihood. The individual contribution to the likelihood <span class="math inline">\(L_i\)</span> can therefore be written as <span class="math display">\[
L_i = h(t_i) ^ d_i S(t_i),
\]</span> where <span class="math inline">\(d_i\)</span> is the event indicator variable. The overall likelihood is the product of the individual contributions: <span class="math display">\[
L = \prod_{i = 1} ^ n L_i.
\]</span> Taking the natural logarithm of the likelihood for ease of computation: <span class="math display">\[
\begin{aligned}
\log L &amp;= \sum_{i = 1} ^ n \left[ d_i \log f_i(t_i) + (1 - d_i) \log S_i(t_i) \right] = \\
       &amp;= \sum_{i = 1} ^ n \left[ d_i \log h_i(t_i) + \log S_i(t_i) \right]
\end{aligned}
\]</span> Implicit in the above log-likelihood are the regression parameters <span class="math inline">\(\beta\)</span> and the parameters of the parametric distribution of choice for <span class="math inline">\(h_0(t)\)</span>.</p>
<p>The log-likelihood function <span class="math inline">\(\log L\)</span> has a closed-form; maximum likelihood estimates for <span class="math inline">\(\beta\)</span> and the distribution parameters can hence be obtained by maximising <span class="math inline">\(\log L\)</span>, e.g. using one of the many general purpose optimisers available in R (<code>optim</code>, <code>nlm</code>, …).</p>
</div>
<div id="sa-parsa-example" class="section level3">
<h3><span class="header-section-number">1.5.3</span> Data analysis example</h3>
<p>The International Stroke Trial (IST) was a large, prospective, randomised controlled trial conducted between 1991 and 1996. The aim of the trial was to assess whether early administration of aspirin, heparin, both or neither influenced clinical outcomes in patients with acute ischaemic stroke <span class="citation">(International Stroke Trial Collaborative Group <a href="#ref-ist_1997">1997</a>, <span class="citation">Sandercock, Niewada, and Czlonkowska (<a href="#ref-istdb_2011">2011</a>)</span>)</span>.</p>
<p>As illustration, I will evaluate the association between tretment with aspirin and/or heparin and survival after acute ischaemic stroke. I will start by reading the data, store in the <code>ist.csv</code> file. This file is a subset of the full IST dataset containing information on age, gender, treatment, and survival; further, individuals with missing values and individuals with a survival time of zero were dropped.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># library(readr)</span>
ist =<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;data/ist.csv&quot;</span>, 
  <span class="dt">col_names =</span> <span class="kw">c</span>(<span class="st">&quot;gender&quot;</span>, <span class="st">&quot;age&quot;</span>, <span class="st">&quot;rxasp&quot;</span>, <span class="st">&quot;rxhep&quot;</span>, <span class="st">&quot;d&quot;</span>, <span class="st">&quot;t&quot;</span>), 
  <span class="dt">col_types =</span> <span class="st">&quot;ciccii&quot;</span>, <span class="dt">skip =</span> <span class="dv">1</span>)
<span class="kw">attr</span>(ist, <span class="st">&quot;spec&quot;</span>) =<span class="st"> </span><span class="ot">NULL</span> <span class="co"># removing &quot;spec&quot; attribute</span>
<span class="kw">str</span>(ist)</code></pre></div>
<pre><code>## Classes &#39;tbl_df&#39;, &#39;tbl&#39; and &#39;data.frame&#39;:    19378 obs. of  6 variables:
##  $ gender: chr  &quot;M&quot; &quot;M&quot; &quot;F&quot; &quot;M&quot; ...
##  $ age   : int  69 76 71 81 78 54 77 23 47 81 ...
##  $ rxasp : chr  &quot;Y&quot; &quot;N&quot; &quot;Y&quot; &quot;N&quot; ...
##  $ rxhep : chr  &quot;N&quot; &quot;L&quot; &quot;N&quot; &quot;H&quot; ...
##  $ d     : int  0 0 0 0 0 0 0 0 0 0 ...
##  $ t     : int  187 192 189 183 214 185 194 193 193 189 ...</code></pre>
<p>I fit first a parametric survival model assuming a Weibull distribution for <span class="math inline">\(h_0(t)\)</span>. The hazard function, including covariates and the imposing proportional hazards, has the form <span class="math display">\[
h(t) = \lambda p t ^ {p - 1} \exp(X \beta),
\]</span> while the survival function has the form <span class="math display">\[
S(t) = \exp(-\lambda t ^ p \exp(X \beta)).
\]</span> <span class="math inline">\(X\)</span> is the model design matrix, and <span class="math inline">\(\beta\)</span> is the vector of regression coefficients. The log-likelihood has the form <span class="math display">\[
\log L = \sum_{i = 1} ^ n \left[ d_i \log h_i(t_i) + \log S_i(t_i) \right]
\]</span></p>
<p>First, I code a function with the model log-likelihood. The function depends on (1) the model parameters <span class="math inline">\(\beta\)</span>, <span class="math inline">\(\lambda\)</span>, and <span class="math inline">\(p\)</span> (<code>pars</code> argument), (2) the model design matrix <span class="math inline">\(X\)</span> (<code>X</code> argument), and (3) survival time <span class="math inline">\(t\)</span> and event indicator <span class="math inline">\(d\)</span> (<code>t</code> and <code>d</code> arguments):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ll =<span class="st"> </span><span class="cf">function</span>(pars, X, t, d) {
  lambda =<span class="st"> </span><span class="kw">exp</span>(pars[<span class="dv">1</span>])
  p =<span class="st"> </span><span class="kw">exp</span>(pars[<span class="dv">2</span>])
  beta =<span class="st"> </span>pars[<span class="op">-</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>)]
  log_hi =<span class="st"> </span><span class="kw">log</span>(lambda) <span class="op">+</span><span class="st"> </span><span class="kw">log</span>(p) <span class="op">+</span><span class="st"> </span>(p <span class="op">-</span><span class="st"> </span><span class="dv">1</span>) <span class="op">*</span><span class="st"> </span><span class="kw">log</span>(t) <span class="op">+</span><span class="st"> </span><span class="kw">c</span>(X <span class="op">%*%</span><span class="st"> </span>beta)
  log_Si =<span class="st"> </span><span class="op">-</span>lambda <span class="op">*</span><span class="st"> </span>t <span class="op">^</span><span class="st"> </span>p <span class="op">*</span><span class="st"> </span><span class="kw">exp</span>(<span class="kw">c</span>(X <span class="op">%*%</span><span class="st"> </span>beta))
  ll =<span class="st"> </span><span class="kw">sum</span>(d <span class="op">*</span><span class="st"> </span>log_hi <span class="op">+</span><span class="st"> </span>log_Si) <span class="co"># + sum(log(t))</span>
  <span class="co"># + sum(log(t)) is the same adjustment that Stata does to remove the time units from log L</span>
  <span class="kw">return</span>(<span class="op">-</span>ll)
}</code></pre></div>
<p>The function <code>ll()</code> returns the negative log-likelihood as most optimisers minimise a target function (and so does <code>optim</code>); however, minimising the negative log-likelihood function is equivalent to maximising the log-likelihood.</p>
<p>I define the model matrix <span class="math inline">\(X\)</span> for a model with aspirin treatment, heparin treatment, and their interactions. The first column is removed to avoid collinearity:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">X =<span class="st"> </span><span class="kw">with</span>(ist, <span class="kw">model.matrix</span>(t <span class="op">~</span><span class="st"> </span>rxasp <span class="op">*</span><span class="st"> </span>rxhep <span class="op">-</span><span class="st"> </span><span class="dv">1</span>))[,<span class="op">-</span><span class="dv">1</span>]</code></pre></div>
<p>Next, I define the starting values for the optmisation routine. I choose the value 1 for the parameters of the Weibull distribution and the value 0 for the regression coefficients:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">start =<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="kw">rep</span>(<span class="dv">0</span>, <span class="kw">ncol</span>(X)))
<span class="kw">names</span>(start) =<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;lambda&quot;</span>, <span class="st">&quot;p&quot;</span>, <span class="kw">colnames</span>(X))</code></pre></div>
<p>The value of the log-likelihood function at the starting values is 92861232771.614. Finally, I use the <code>BFGS</code> optimiser (details in <span class="citation">Fletcher (<a href="#ref-fletcher_2000">2000</a>)</span>) to maximise the log-likelihood:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">fit =<span class="st"> </span><span class="kw">optim</span>(<span class="dt">par =</span> start, <span class="dt">fn =</span> ll, <span class="dt">X =</span> X, <span class="dt">t =</span> ist<span class="op">$</span>t, <span class="dt">d =</span> ist<span class="op">$</span>d, <span class="dt">method =</span> <span class="st">&quot;BFGS&quot;</span>, <span class="dt">hessian =</span> <span class="ot">TRUE</span>)</code></pre></div>
<p>The maximum likelihood estimates are:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">fit<span class="op">$</span>par</code></pre></div>
<pre><code>##        lambda             p        rxaspY        rxhepL        rxhepN 
## -3.8092759891 -0.7590655762  0.0003598517  0.0418030804 -0.0434537345 
## rxaspY:rxhepL rxaspY:rxhepN 
## -0.1332146443 -0.0391667415</code></pre>
<p>The standard errors of the maximum likelihood estimates are obtained by inverting the resulting Hessian:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">fit<span class="op">$</span>vcov =<span class="st"> </span><span class="kw">solve</span>(fit<span class="op">$</span>hessian)
fit<span class="op">$</span>se =<span class="st"> </span><span class="kw">sqrt</span>(<span class="kw">diag</span>(<span class="kw">solve</span>(fit<span class="op">$</span>hessian)))</code></pre></div>
<p>Finally, I build a table of results:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">res =<span class="st"> </span><span class="kw">data.frame</span>(
  <span class="dt">coef =</span> fit<span class="op">$</span>par,
  <span class="dt">hr =</span> <span class="kw">exp</span>(fit<span class="op">$</span>par),
  <span class="dt">se =</span> fit<span class="op">$</span>se)
res<span class="op">$</span>z =<span class="st"> </span>res<span class="op">$</span>coef <span class="op">/</span><span class="st"> </span>res<span class="op">$</span>se
res<span class="op">$</span>p =<span class="st"> </span><span class="dv">1</span> <span class="op">-</span><span class="st"> </span><span class="kw">pnorm</span>(<span class="kw">abs</span>(res<span class="op">$</span>z), <span class="dv">1</span> <span class="op">-</span><span class="st"> </span><span class="fl">0.05</span> <span class="op">/</span><span class="st"> </span><span class="dv">2</span>)
<span class="kw">kable</span>(res, <span class="dt">digits =</span> <span class="dv">3</span>)</code></pre></div>
<table>
<thead>
<tr class="header">
<th></th>
<th align="right">coef</th>
<th align="right">hr</th>
<th align="right">se</th>
<th align="right">z</th>
<th align="right">p</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>lambda</td>
<td align="right">-3.809</td>
<td align="right">0.022</td>
<td align="right">0.055</td>
<td align="right">-69.144</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td>p</td>
<td align="right">-0.759</td>
<td align="right">0.468</td>
<td align="right">0.015</td>
<td align="right">-51.985</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td>rxaspY</td>
<td align="right">0.000</td>
<td align="right">1.000</td>
<td align="right">0.060</td>
<td align="right">0.006</td>
<td align="right">0.834</td>
</tr>
<tr class="even">
<td>rxhepL</td>
<td align="right">0.042</td>
<td align="right">1.043</td>
<td align="right">0.059</td>
<td align="right">0.704</td>
<td align="right">0.607</td>
</tr>
<tr class="odd">
<td>rxhepN</td>
<td align="right">-0.043</td>
<td align="right">0.957</td>
<td align="right">0.052</td>
<td align="right">-0.832</td>
<td align="right">0.557</td>
</tr>
<tr class="even">
<td>rxaspY:rxhepL</td>
<td align="right">-0.133</td>
<td align="right">0.875</td>
<td align="right">0.085</td>
<td align="right">-1.563</td>
<td align="right">0.278</td>
</tr>
<tr class="odd">
<td>rxaspY:rxhepN</td>
<td align="right">-0.039</td>
<td align="right">0.962</td>
<td align="right">0.074</td>
<td align="right">-0.528</td>
<td align="right">0.673</td>
</tr>
</tbody>
</table>
<p>Wald test for the interaction terms, using the <span class="math inline">\(\chi^2\)</span> test statistic (as sample size is big, using the F statistic would be equivalent):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># identify the interaction terms</span>
idx =<span class="st"> </span><span class="kw">grepl</span>(<span class="st">&quot;:&quot;</span>, <span class="kw">names</span>(fit<span class="op">$</span>par))

<span class="co"># compute the W statistic</span>
W =<span class="st"> </span><span class="kw">t</span>(fit<span class="op">$</span>par[idx]) <span class="op">%*%</span><span class="st"> </span><span class="kw">solve</span>(fit<span class="op">$</span>vcov[idx, idx]) <span class="op">%*%</span><span class="st"> </span>fit<span class="op">$</span>par[idx]

<span class="co"># test it against the quantiles of a chi2 distribution with sum(idx) degrees of freedom</span>
<span class="kw">c</span>(<span class="dt">W =</span> W, <span class="dt">p =</span> <span class="dv">1</span> <span class="op">-</span><span class="st"> </span><span class="kw">pchisq</span>(W, <span class="kw">sum</span>(idx)))</code></pre></div>
<pre><code>##         W         p 
## 2.6367536 0.2675693</code></pre>
</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-ist_1997">
<p>International Stroke Trial Collaborative Group. 1997. “The International Stroke Trial (Ist): A Randomised Trial of Aspirin, Subcutaneous Heparin, Both, or Neither Among 19 435 Patients with Acute Ischaemic Stroke.” <em>The Lancet</em> 349 (9065): 1569–81. doi:<a href="https://doi.org/10.1016/S0140-6736(97)04011-7">10.1016/S0140-6736(97)04011-7</a>.</p>
</div>
<div id="ref-istdb_2011">
<p>Sandercock, Peter, Maciej Niewada, and Anna Czlonkowska. 2011. “International Stroke Trial Database (Version 2).” University of Edinburgh, Department of Clinical Neuroscience. doi:<a href="https://doi.org/10.7488/ds/104.">10.7488/ds/104.</a></p>
</div>
<div id="ref-azzalini_1985">
<p>Azzalini, A. 1985. “A Class of Distributions Which Include the Normal Ones.” <em>Scandinavian Journal of Statistics</em> 12 (2): 171–78. <a href="http://www.jstor.org/stable/4615982" class="uri">http://www.jstor.org/stable/4615982</a>.</p>
</div>
<div id="ref-mclachlan_1994">
<p>McLachlan, GJ, and DC McGiffin. 1994. “On the Role of Finite Mixture Models in Survival Analysis.” <em>Statistical Methods in Medical Research</em> 3 (3): 221–26. doi:<a href="https://doi.org/10.1177/096228029400300302">10.1177/096228029400300302</a>.</p>
</div>
<div id="ref-fletcher_2000">
<p>Fletcher, Roger. 2000. <em>Practical Methods of Optimization</em>. 2nd ed. New York, NY, USA: Wiley.</p>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="2">
<li id="fn2"><p><span class="math inline">\(SN(\cdot)\)</span> is the cumulative distribution function of a skew-Normal random variable with parameters <span class="math inline">\(\xi\)</span>, <span class="math inline">\(\omega\)</span>, and <span class="math inline">\(\alpha\)</span> <span class="citation">(Azzalini <a href="#ref-azzalini_1985">1985</a>)</span><a href="sa-parsa.html#fnref2">↩</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="sa-estsurv.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="sa-cox.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": true,
"google": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"download": ["Probation_review_report_AG.pdf", "Probation_review_report_AG.epub", "Probation_review_report_AG.mobi"],
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(script.src))
      script.src  = script.src.replace(/^https?:/, '');
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
